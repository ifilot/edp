name: sphinx

on: [push]
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
  paper:
    runs-on: ubuntu-latest
    name: build-docs
     steps:
     - uses: actions/checkout@v3
     - name: Install packages
       run: sudo apt install -y git build-essential curl wget python3 python3-pip texlive texlive-pictures texlive-latex-extra pdf2svg poppler-utils netpbm imagemagick ghostscript
     - name: Install Python packages
       run: sudo pip install sphinx sphinx-rtd-theme sphinxcontrib-tikz
     - name: Build documentation
       run: cd docs && make html
     - name: Install SSH Key
       uses: shimataro/ssh-key-action@v2
       with:
         key: {%- raw -%} ${{ secrets.SSH_PRIVATE_KEY }}
         known_hosts: 'just-a-placeholder-so-we-dont-get-errors'
     - name: Adding Known Hosts
       run: ssh-keyscan -H ${{ secrets.SSH_HOST }}{% endraw%} >> ~/.ssh/known_hosts
     - name: Deploy
       run: scp ./docs/_build/html/* ${{ secrets.SSH_USER }}@${{ secrets.SSH_HOST }}:${{ secrets.DEPLOY_PATH }}
